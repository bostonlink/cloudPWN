# EC2 SET Installation notes for Ubuntu Server 12.04.2 LTS x86 installation in EC2
# EC2 instance setup guide to create and save a custom SET AMI image within EC2 to Launch

# Create a new EC2 instance of Ubuntu Server 12.04.2 LTS 32-bit system
# Once the system has been created and launched SSH into the system and follow the below steps


# Git clone SET https://github.com/trustedsec/social-engineer-toolkit
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install git
cd ~/ 
git clone https://github.com/trustedsec/social-engineer-toolkit.git
cd social-engineer-toolkit/

# installs SET to /usr/share/setoolkit and all dependecies
sudo python setup.py install
cd 

# Now we must install Core Security 'Impacket' python module 
#from http://corelabs.coresecurity.com/index.php?module=Wiki&action=view&type=tool&name=Impacket

wget 'http://corelabs.coresecurity.com/index.php?module=Wiki&action=attachment&type=tool&page=Impacket&file=impacket-0.9.9.9.tar.gz' -O impacket-0.9.9.9.tar.gz

mv index.php\?module\=Wiki\&action\=attachment\&type\=tool\&page\=Impacket\&file\=impacket-0.9.9.9.tar.gz impacket-0.9.9.9.tar.gz

tar xzf impacket-0.9.9.9.tar.gz
cd impacket
sudo python setup.py install

# Metasploit installation
## source: http://www.darkoperator.com/installing-metasploit-in-ubunt/ (Thanks to Carlos Perez)

# Install metasploit dependencies

# dependencies
sudo apt-get install build-essential libreadline-dev  libssl-dev libpq5 libpq-dev libreadline5 libsqlite3-dev libpcap-dev openjdk-7-jre subversion git-core autoconf postgresql pgadmin3 curl zlib1g-dev libxml2-dev libxslt1-dev vncviewer libyaml-dev ruby1.9.3

# Install the requires gems for metasploit install
# required gems
sudo gem install wirble sqlite3 bundler

# Install Nmap
mkdir ~/tools
cd ~/tools
wget http://nmap.org/dist/nmap-6.25.tar.bz2
tar jxf nmap-6.25.tar.bz2
cd nmap-6.25/
./configure
make
sudo make install
sudo make clean
cd 

# Postgres Configuration 

sudo -s
su postgres

createuser msf -P -S -R -D # password = password for msf user
createdb -O msf msf
exit
exit

# Installing Metasploit ;)

cd /opt
sudo git clone https://github.com/rapid7/metasploit-framework.git
cd metasploit-framework
sudo bash -c 'for MSF in $(ls msf*); do ln -s /opt/metasploit-framework/$MSF /usr/local/bin/$MSF;done'

bundle install

sudo vim /opt/metasploit-framework/database.yml

# Contents of /opt/metasploit-framework/database.yml take all the # out

#production:
   #adapter: postgresql
   #database: msf
   #username: msf
   #password: [enter msf db password here]
   #host: 127.0.0.1
   #port: 5432
   #pool: 75
   #timeout: 5

sudo sh -c "echo export MSF_DATABASE_CONFIG=/opt/metasploit-framework/database.yml >> /etc/profile"
source /etc/profile

# metasploit is installed launch and make sure metasploit runs correctly 'sudo msfconsole' may take a little bit to initialize

# Now we have to edit the SET config file to tell it where metasploit is installed.
# If you are planning on using the SET config file within cloudPWN change the directory there as well.

cd /usr/share/setoolkit
sudo vim config/set_config
# change the metasploit directory to /opt/metasploit-framework/

# To get set-automate to work we need to modify line 57 of the code and change the following
# line 57 original code: child=pexpect.spawn("python set")
# line 57 modified code: child=pexpect.spawn("python se-toolkit")
# Opened GIT issue #22 for this issue the above is a workaround until it is resolved

# Then move the /usr/share/setoolkit directory to /usr/share/set
sudo mv /usr/share/setoolkit /usr/share/set

# For Apache support we need to install apache2

sudo apt-get install -f apache2 libapache2-mod-php5
sudo update-rc.d apache2 disable
sudo service apache2 stop

# Now we are done!